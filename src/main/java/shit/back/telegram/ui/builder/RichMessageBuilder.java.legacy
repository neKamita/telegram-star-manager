package shit.back.telegram.ui.builder;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import shit.back.config.PaymentConfigurationProperties;
import shit.back.domain.balance.valueobjects.Currency;
import shit.back.domain.balance.valueobjects.Money;
import shit.back.telegram.ui.strategy.utils.PaymentMethodsHelper;
import shit.back.telegram.ui.strategy.utils.StrategyConstants;

import java.time.LocalDateTime;
import java.util.List;

/**
 * Ğ‘Ğ¸Ğ»Ğ´ĞµÑ€ Ğ±Ğ¾Ğ³Ğ°Ñ‚Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Telegram Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°
 * 
 * Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹
 * Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ emoji, Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ Ğ¿Ğ¾Ğ´Ğ°Ñ‡Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
 */
@Component
public class RichMessageBuilder {

    @Autowired
    private PaymentConfigurationProperties paymentConfig;

    /**
     * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
     */
    public String createBalanceCard(DualBalanceResponse balance) {
        if (balance == null) {
            return "âŒ <b>ĞÑˆĞ¸Ğ±ĞºĞ°</b>\n\nĞ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹";
        }

        StringBuilder card = new StringBuilder();
        String currencySymbol = balance.getCurrency().getSymbol();
        String statusIcon = balance.isActive() ? "âœ…" : "âŒ";

        // Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸
        card.append("ğŸ’° <b>ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°</b>\n");
        card.append("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

        // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
        card.append("ğŸ“Š <b>Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ• Ğ¡Ğ§Ğ•Ğ¢ĞĞ’</b>\n");
        card.append(String.format("ğŸ’³ ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹: <code>%s %s</code>\n",
                balance.getBankBalance().getFormattedAmount(), currencySymbol));
        card.append(String.format("ğŸ¦ Ğ Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹: <code>%s %s</code>\n",
                balance.getMainBalance().getFormattedAmount(), currencySymbol));
        card.append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");
        card.append(String.format("ğŸ“ˆ <b>Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: %s %s</b>\n\n",
                balance.getTotalBalance().getFormattedAmount(), currencySymbol));

        // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
        card.append("ğŸš¦ <b>Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ Ğ“ĞĞ¢ĞĞ’ĞĞĞ¡Ğ¢Ğ˜</b>\n");
        if (balance.hasMainFunds()) {
            card.append("â­ <b>Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞµ Ğ·Ğ²ĞµĞ·Ğ´!</b>\n");
        } else if (balance.hasBankFunds()) {
            card.append("ğŸ”„ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ\n");
        } else {
            card.append("ğŸ’¸ ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°\n");
        }
        card.append("\n");

        // Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
        if (balance.getTotalTransferredToMain().isPositive() || balance.getTotalSpentFromMain().isPositive()) {
            card.append("ğŸ“ˆ <b>Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ</b>\n");
            if (balance.getTotalTransferredToMain().isPositive()) {
                card.append(String.format("ğŸ’¸ ĞŸĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ¾: %s %s\n",
                        balance.getTotalTransferredToMain().getFormattedAmount(), currencySymbol));
            }
            if (balance.getTotalSpentFromMain().isPositive()) {
                card.append(String.format("â­ ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‡ĞµĞ½Ğ¾: %s %s\n",
                        balance.getTotalSpentFromMain().getFormattedAmount(), currencySymbol));
            }

            if (balance.getMainBalanceUtilizationRatio() > 0) {
                double utilizationPercent = balance.getMainBalanceUtilizationRatio() * 100;
                String utilizationIcon = utilizationPercent > 70 ? "ğŸ”¥" : utilizationPercent > 30 ? "ğŸ“Š" : "ğŸ“‰";
                card.append(String.format("%s Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: %.1f%%\n", utilizationIcon, utilizationPercent));
            }
            card.append("\n");
        }

        // Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
        card.append("â„¹ï¸ <b>Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯</b>\n");
        card.append(String.format("ğŸ’± Ğ’Ğ°Ğ»ÑÑ‚Ğ°: %s\n", balance.getCurrency().getFormattedName()));
        card.append(String.format("%s Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: %s\n", statusIcon,
                balance.isActive() ? "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½" : "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½"));
        card.append(String.format("ğŸ• ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½: %s\n",
                balance.getLastUpdated().format(StrategyConstants.DATE_FORMATTER)));

        return card.toString();
    }

    /**
     * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº
     */
    public String createPurchaseHistoryCard(List<PurchaseHistoryItem> purchases, int page, boolean hasNext) {
        StringBuilder card = new StringBuilder();

        // Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº
        card.append("ğŸ“Š <b>Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº Ğ·Ğ²ĞµĞ·Ğ´</b>\n");
        card.append("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

        if (purchases.isEmpty()) {
            card.append("ğŸ“ <i>Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº Ğ¿ÑƒÑÑ‚Ğ°</i>\n\n");
            card.append("ğŸ’¡ Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºÑƒ Ğ·Ğ²ĞµĞ·Ğ´!");
            return card.toString();
        }

        // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
        for (int i = 0; i < purchases.size(); i++) {
            PurchaseHistoryItem item = purchases.get(i);
            card.append(String.format("â­ <b>%d Ğ·Ğ²ĞµĞ·Ğ´</b> â€¢ %s %s\n",
                    item.stars, item.amount.getFormattedAmount(), item.currencySymbol));
            card.append(String.format("ğŸ“… %s â€¢ %s\n",
                    item.date.format(StrategyConstants.DATE_FORMATTER),
                    getStatusIcon(item.status) + " " + item.status));

            if (i < purchases.size() - 1) {
                card.append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");
            }
        }

        // ĞŸĞ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ
        card.append("\n");
        card.append(String.format("ğŸ“„ <b>Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° %d</b>", page + 1));
        if (hasNext) {
            card.append(" â€¢ <i>Ğ•ÑÑ‚ÑŒ ĞµÑ‰Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</i>");
        }

        return card.toString();
    }

    /**
     * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½ÑƒÑ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ
     */
    public String createWelcomeCard(String userName, DualBalanceResponse balance) {
        StringBuilder card = new StringBuilder();

        // ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ
        card.append(String.format("ğŸ‘‹ <b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, %s!</b>\n", userName));
        card.append("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

        // ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
        card.append("â­ <b>Star Manager Bot</b>\n");
        card.append("ğŸ¤– Ğ’Ğ°Ñˆ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸ Telegram Stars\n\n");

        // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
        if (balance != null && balance.getTotalBalance().isPositive()) {
            String currencySymbol = balance.getCurrency().getSymbol();
            card.append("ğŸ’° <b>Ğ’Ğ°Ñˆ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ:</b>\n");
            card.append(String.format("ğŸ“Š Ğ’ÑĞµĞ³Ğ¾: %s %s\n",
                    balance.getTotalBalance().getFormattedAmount(), currencySymbol));

            if (balance.hasMainFunds()) {
                card.append("âœ… <i>Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞµ Ğ·Ğ²ĞµĞ·Ğ´!</i>\n\n");
            } else if (balance.hasBankFunds()) {
                card.append("ğŸ”„ <i>ĞŸĞµÑ€ĞµĞ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ</i>\n\n");
            }
        } else {
            card.append("ğŸ’° <b>Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¿ÑƒÑÑ‚</b>\n");
            card.append("ğŸš€ <i>ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ñ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ!</i>\n\n");
        }

        // ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
        card.append("ğŸ”„ <b>ĞšĞĞš Ğ­Ğ¢Ğ Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢</b>\n");
        card.append("1ï¸âƒ£ ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑƒĞ´Ğ¾Ğ±Ğ½Ñ‹Ğ¼ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¾Ğ¼\n");
        card.append("2ï¸âƒ£ ĞŸĞµÑ€ĞµĞ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ° Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ\n");
        card.append("3ï¸âƒ£ ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ğ¹Ñ‚Ğµ Ğ·Ğ²ĞµĞ·Ğ´Ñ‹ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸ĞµĞ¼\n");
        card.append("4ï¸âƒ£ Ğ—Ğ²ĞµĞ·Ğ´Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿ÑÑ‚ Ğ½Ğ° Ğ²Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚\n\n");

        // Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        Currency userCurrency = balance != null ? balance.getCurrency() : Currency.defaultCurrency();
        List<String> paymentMethods = PaymentMethodsHelper.getAvailablePaymentMethods(userCurrency, paymentConfig);

        if (!paymentMethods.isEmpty()) {
            card.append("ğŸ’³ <b>Ğ¡ĞŸĞĞ¡ĞĞ‘Ğ« ĞŸĞĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯</b>\n");
            for (String method : paymentMethods) {
                card.append(String.format("â€¢ %s\n", method));
            }
            card.append("\n");
        }

        card.append("ğŸ¯ <i>Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ? ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«ğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½ÑÂ»!</i>");

        return card.toString();
    }

    /**
     * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ñ„Ğ»Ğ¾Ñƒ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸
     */
    public String createPurchaseFlowCard(int stars, Money amount, String currencySymbol,
            DualBalanceResponse balance) {
        StringBuilder card = new StringBuilder();

        // Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
        card.append("â­ <b>ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° Telegram Stars</b>\n");
        card.append("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

        // Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸
        card.append("ğŸ›’ <b>Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ ĞŸĞĞšĞ£ĞŸĞšĞ˜</b>\n");
        card.append(String.format("â­ Ğ—Ğ²ĞµĞ·Ğ´: <b>%d</b>\n", stars));
        card.append(String.format("ğŸ’° Ğ¡ÑƒĞ¼Ğ¼Ğ°: <b>%s %s</b>\n", amount.getFormattedAmount(), currencySymbol));
        card.append("\n");

        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
        card.append("ğŸ’³ <b>ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ Ğ•Ğ”Ğ¡Ğ¢Ğ’</b>\n");
        if (balance.hasSufficientMainFunds(amount)) {
            card.append("âœ… Ğ¡Ñ€ĞµĞ´ÑÑ‚Ğ² Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾\n");
            Money remaining = balance.getMainBalance().subtract(amount);
            card.append(String.format("ğŸ’¼ ĞÑÑ‚Ğ°Ñ‚Ğ¾Ğº: %s %s\n",
                    remaining.getFormattedAmount(), currencySymbol));
        } else {
            card.append("âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑÑ€ĞµĞ´ÑÑ‚Ğ²\n");
            Money needed = amount.subtract(balance.getMainBalance());
            card.append(String.format("ğŸ’¸ ĞĞµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚: %s %s\n",
                    needed.getFormattedAmount(), currencySymbol));
        }
        card.append("\n");

        // ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸
        card.append("ğŸ”„ <b>ĞŸĞ ĞĞ¦Ğ•Ğ¡Ğ¡ ĞŸĞĞšĞ£ĞŸĞšĞ˜</b>\n");
        card.append("1ï¸âƒ£ Ğ¡Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ³Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°\n");
        card.append("2ï¸âƒ£ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Telegram Fragment\n");
        card.append("3ï¸âƒ£ Ğ—Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ²ĞµĞ·Ğ´ Ğ½Ğ° Ğ²Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚\n");
        card.append("4ï¸âƒ£ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¸\n\n");

        card.append("âš ï¸ <b>Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ:</b> ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ°\n");
        card.append("ğŸ¤– <i>ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸</i>");

        return card.toString();
    }

    /**
     * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
     */
    public String createTransferConfirmationCard(Money amount, String currencySymbol,
            DualBalanceResponse balance) {
        StringBuilder card = new StringBuilder();

        card.append("ğŸ”„ <b>ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ ÑÑ€ĞµĞ´ÑÑ‚Ğ²</b>\n");
        card.append("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

        // Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
        card.append("ğŸ’¸ <b>Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ ĞŸĞ•Ğ Ğ•Ğ’ĞĞ”Ğ</b>\n");
        card.append(String.format("ğŸ’° Ğ¡ÑƒĞ¼Ğ¼Ğ°: <b>%s %s</b>\n", amount.getFormattedAmount(), currencySymbol));
        card.append("ğŸ“¤ Ğ˜Ğ·: ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ\n");
        card.append("ğŸ“¥ Ğ’: Ğ Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ\n\n");

        // Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ¾ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
        card.append("ğŸ“Š <b>Ğ”Ğ ĞŸĞ•Ğ Ğ•Ğ’ĞĞ”Ğ</b>\n");
        card.append(String.format("ğŸ’³ ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹: %s %s\n",
                balance.getBankBalance().getFormattedAmount(), currencySymbol));
        card.append(String.format("ğŸ¦ Ğ Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹: %s %s\n\n",
                balance.getMainBalance().getFormattedAmount(), currencySymbol));

        // Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
        Money newBankBalance = balance.getBankBalance().subtract(amount);
        Money newMainBalance = balance.getMainBalance().add(amount);

        card.append("ğŸ“ˆ <b>ĞŸĞĞ¡Ğ›Ğ• ĞŸĞ•Ğ Ğ•Ğ’ĞĞ”Ğ</b>\n");
        card.append(String.format("ğŸ’³ ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹: %s %s\n",
                newBankBalance.getFormattedAmount(), currencySymbol));
        card.append(String.format("ğŸ¦ Ğ Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹: %s %s\n\n",
                newMainBalance.getFormattedAmount(), currencySymbol));

        card.append("âœ… <i>ĞŸĞ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° Ğ²Ñ‹ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ÑŒ Ğ·Ğ²ĞµĞ·Ğ´Ñ‹</i>");

        return card.toString();
    }

    /**
     * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ĞºĞ¾Ğ½ĞºÑƒ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
     */
    private String getStatusIcon(String status) {
        return switch (status.toLowerCase()) {
            case "completed", "Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾" -> "âœ…";
            case "pending", "Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ" -> "â³";
            case "failed", "Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ°" -> "âŒ";
            case "cancelled", "Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾" -> "ğŸš«";
            default -> "ğŸ“„";
        };
    }

    /**
     * ĞšĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº
     */
    public static class PurchaseHistoryItem {
        public final int stars;
        public final Money amount;
        public final String currencySymbol;
        public final LocalDateTime date;
        public final String status;

        public PurchaseHistoryItem(int stars, Money amount, String currencySymbol,
                LocalDateTime date, String status) {
            this.stars = stars;
            this.amount = amount;
            this.currencySymbol = currencySymbol;
            this.date = date;
            this.status = status;
        }
    }
}